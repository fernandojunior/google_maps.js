// Copyright (c) 2015 Fernando Felix do Nascimento Junior
var Container=Class.extend({objects:{},prototype:{constructor:function(e){this.register=e.register;if(typeof this.register=="undefined"||!this.register)return;if(this.register)this.class.register(this);else this.class.register(this.register,this)}},register:function(e,t){if(arguments.length==1)this.objects["default"]=arguments[0];else this.objects[e]=t},get:function(){var e="default";if(arguments.length==1&&arguments[0]!=true)e=arguments[0];return this.objects[e]}});var Singleton=Class.extend({object:undefined,get:function(){if(typeof this.object=="undefined"){this.object=this.create()}return this.object}});var Map=Container.simple_extend({constructor:function(e){this.super("constructor",[e]);this.canvas=e.canvas;if(typeof this.canvas==typeof "")this.canvas=document.getElementById(this.canvas);this.options=e;delete this.options["register"];delete this.options["canvas"];var t=this.options.center;this.options.center=new google.maps.LatLng(t[0],t[1]);this.resource=new google.maps.Map(this.canvas,this.options)}});var Geocoder=Singleton.simple_extend({constructor:function(){this.queries={};this.resource=new google.maps.Geocoder},geocode:function(e,t){var n=this;var r=this.queries[e.address];if(typeof r=="undefined"){(function(e,t,r){e.resource.geocode(t,function(i,s){if(s==google.maps.GeocoderStatus.OK)e.queries[i[0].formatted_address]=arguments;if(s=="OVER_QUERY_LIMIT"){setTimeout(function(){n.geocode(t,r)},2e3);return}e.queries[t.address]=arguments;e.geocode(t,r)})})(this,e,t)}else{t(r[0],r[1])}}});var InfoWindow=Class.simple_extend({constructor:function(e){this.resource=new google.maps.InfoWindow(e);if(typeof e.marker!="undefined")this.resource.open(e.marker.resource.map,e.marker.resource)},on:function(e,t){var n=this;if(typeof arguments[0]==typeof []){var r=arguments[0];for(var i in r)google.maps.event.addListener(n.resource,i,function(){r[i](n.resource)})}else{google.maps.event.addListener(n.resource,e,t)}}});var Marker=Class.extend({prototype:{constructor:function(e){var t=e.map;if(typeof t=="undefined")t=Map.get().resource;else if(typeof t==typeof "")t=Map.get(t).resource;else t=t.resource;e.map=t;this.address=e.address;this.content=e.content;this.events=e.events;var n=e.draw;this.options=e;delete this.options["address"];delete this.options["content"];delete this.options["draw"];this.drawing=false;this.drawed=false;this.error=false;if(typeof n=="undefined"||n)this.draw()},draw:function(){if(this.drawing)return;if(!this.drawed)this.render();else this.resource.setMap(this.options.map)},undraw:function(){if(typeof this.resource!="undefined")this.resource.setMap(undefined)},on:function(e,t){var n=this;if(typeof arguments[0]==typeof []){var r=arguments[0];for(var i in r)google.maps.event.addListener(n.resource,i,function(){r[i](n.resource)})}else{google.maps.event.addListener(n.resource,e,t)}},render:function(){var e=this;e.drawing=true;var t=Geocoder.get();t.geocode({address:e.address},function(t,n){if(n!=google.maps.GeocoderStatus.OK){console.log("Geocode was not successful for the following reason: "+n+". Query "+e.address);e.error=true}var r=t[0].geometry.location;e.options["position"]=r;e.resource=new google.maps.Marker(e.options);e.resource.test=e;e.resource.geocode=t;if(typeof e.events!="undefined")e.on(e.events);e.drawing=false;e.drawed=true})}}});var Markers=Class.simple_extend({constructor:function(){this.markers=[]},all:function(){return this.all()},push:function(e){this.markers.push(e)},draw:function(){var e=this;var t=0;for(var n in this.markers)this.markers[n].draw()},undraw:function(){for(var e in this.markers)this.markers[e].undraw()},isDrawed:function(){var e=this.markers;for(var t in e)if(!e[t].drawed&&e[t].error==false)return false;return true}})
